<!--view/healthEntries.ejs-->

<%- include("partials/head.ejs") %>
<%- include("partials/header.ejs") %>

<h2 class="mt-1">Health Entries List</h2>

<!-- Add New Health Entry Button -->
<div style="margin-bottom: 5px;">
    <a href="/healthEntries/form">
        <button type="button" class="btn btn-primary">Add New Health Entry</button>
    </a>
</div>

<!-- Filters Form -->
<form method="GET" action="/healthEntries" class="mb-4">
    <div class="row g-3">
        <!-- Date Filter -->
        <div class="col-md-3">
            <input type="date" class="form-control" name="date" placeholder="Filter by Date" value="<%= dateFilter || '' %>">
        </div>
        <!-- Time Filter -->
        <div class="col-md-3">
            <input type="time" class="form-control" name="timeFrom" placeholder="From Time" value="<%= timeFromFilter || '' %>">
            <input type="time" class="form-control mt-2" name="timeTo" placeholder="To Time" value="<%= timeToFilter || '' %>">
        </div>
        <!-- Blood Sugar Level Filter -->
        <div class="col-md-3">
            <input type="number" class="form-control" name="bloodSugarLevel" placeholder="Filter by Blood Sugar" value="<%= bloodSugarFilter || '' %>">
        </div>
        <!-- Medications Filter -->
        <div class="col-md-3">
            <input type="text" class="form-control" name="medicationsTaken" placeholder="Filter by Medications" value="<%= medicationsFilter || '' %>">
        </div>
        <!-- Physical Activity Filter -->
        <div class="col-md-3">
            <input type="text" class="form-control" name="physicalActivity" placeholder="Filter by Physical Activity" value="<%= activityFilter || '' %>">
        </div>
        <!-- Meal Log Filter -->
        <div class="col-md-3">
            <input type="text" class="form-control" name="mealLog" placeholder="Filter by Meal Log" value="<%= mealLogFilter || '' %>">
        </div>
        <!-- Fasting Glucose Filter -->
        <div class="col-md-3">
            <select class="form-control" name="fastingGlucoseLevel">
                <option value="" <%= !fastingFilter ? "selected" : "" %>>Filter by Fasting Glucose Level</option>
                <option value="true" <%= fastingFilter === 'true' ? "selected" : "" %>>Yes</option>
                <option value="false" <%= fastingFilter === 'false' ? "selected" : "" %>>No</option>
            </select>
        </div>
        <!-- Apply and Reset Buttons -->
        <div class="col-md-3">
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary flex-grow-1">Apply Filters</button>
                <a href="/healthEntries" class="btn btn-secondary flex-grow-1">Reset Filters</a>
            </div>
        </div>
    </div>
</form>

<!-- Health Entries Cards -->
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <% if (healthEntries && healthEntries.length) { %>
        <% healthEntries.forEach((entry) => { %>
            <div class="col">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">Date: <%= entry.date.toISOString().split('T')[0] %></h5>
                        <p class="card-text"><strong>Time:</strong> <%= entry.time %></p>
                        <p class="card-text"><strong>Blood Sugar Level:</strong> <%= entry.bloodSugarLevel %></p>
                        <p class="card-text"><strong>Medications Taken:</strong> <%= entry.medicationsTaken || 'No medications listed' %></p>
                        <p class="card-text"><strong>Physical Activity:</strong> <%= entry.physicalActivityLog || 'No activity logged' %></p>
                        <p class="card-text"><strong>Meal Log:</strong> <%= entry.mealLog || 'No meal logged' %></p>
                        <p class="card-text"><strong>Fasting Glucose Level?:</strong> <%= entry.fastingGlucoseLevel ? 'Yes' : 'No' %></p>
                    </div>
                    <div class="card-footer d-flex justify-content-between">
                        <a href="/healthEntries/<%= entry.id %>" class="btn btn-primary">Show</a>
                        <a href="/healthEntries/form/<%= entry.id %>" class="btn btn-secondary">Edit</a>
                    </div>
                </div>
            </div>
        <% }) %>
    <% } else { %>
        <div class="col-12 text-center">
            <p>No health entries found. Click the "Add New Health Entry" button above to create one!</p>
        </div>
    <% } %>
</div>

<!-- Pagination Controls -->
<div class="d-flex justify-content-between align-items-center mt-4">
    <% const displayTotalPages = totalPages === 0 ? "No health entries" : totalPages; %>
    <% if (hasPrevPage && totalPages > 0) { %>
        <a href="/healthEntries?page=<%= currentPage - 1 %>&limit=<%= limit %>&date=<%= dateFilter %>&bloodSugarLevel=<%= bloodSugarFilter %>&medicationsTaken=<%= medicationsFilter %>&physicalActivity=<%= activityFilter %>&mealLog=<%= mealLogFilter %>&fastingGlucoseLevel=<%= fastingFilter %>&timeFrom=<%= timeFromFilter %>&timeTo=<%= timeToFilter %>" class="btn btn-secondary">Previous</a>
    <% } else { %>
        <button class="btn btn-secondary" disabled>Previous</button>
    <% } %>

    <span>Page <%= currentPage %> of <%= displayTotalPages %></span>

    <% if (hasNextPage && totalPages > 0) { %>
        <a href="/healthEntries?page=<%= currentPage + 1 %>&limit=<%= limit %>&date=<%= dateFilter %>&bloodSugarLevel=<%= bloodSugarFilter %>&medicationsTaken=<%= medicationsFilter %>&physicalActivity=<%= activityFilter %>&mealLog=<%= mealLogFilter %>&fastingGlucoseLevel=<%= fastingFilter %>&timeFrom=<%= timeFromFilter %>&timeTo=<%= timeToFilter %>" class="btn btn-secondary">Next</a>
    <% } else { %>
        <button class="btn btn-secondary" disabled>Next</button>
    <% } %>
</div>

<%- include("partials/footer.ejs") %>
